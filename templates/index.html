<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>Instagram Monitoring Jadvali</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f8fafc;
            margin: 20px;
        }
        h2 {
            text-align: center;
            color: #1e293b;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            background: white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #0f172a;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f1f5f9;
        }
        tr:hover {
            background-color: #e2e8f0;
        }
        a {
            color: #2563eb;
            text-decoration: none;
            font-weight: bold;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h2>üìä Instagram Monitoring Jadvali</h2>
    <table id="monitoringTable">
        <thead>
            <tr>
                <th>‚Ññ</th>
                <th>Media ID</th>
                <th>Post Link</th>
                <th>Views</th>
                <th>Reach</th>
                <th>Shares</th>
                <th>Saved</th>
                <th>+ Comments</th>
                <th>Read DM</th>
                <th>üõí Buy Clicks</th>
                <th>‚ùå Bosmaganlar</th>
                <th>üì© Aloqa Clicks</th>
                <th>CTR (%)</th> <!-- yangi ustun -->
            </tr>
        </thead>
        <tbody>
            {% for row in monitoring_data %}
            <tr>
                <td>{{ row.num }}</td>
                <td>{{ row.media_id }}</td>
                <td><a href="{{ row.media_url }}" target="_blank">Link</a></td>
                <td>{{ row.views }}</td>
                <td class="reach">{{ row.reach }}</td>
                <td>{{ row.shares }}</td>
                <td>{{ row.saved }}</td>
                <td>{{ row.plus_comments }}</td>
                <td class="read_dm">{{ row.read_dm }}</td>
                <td class="buy_clicks">{{ row.buy_clicks }}</td>
                <td class="not_clicked">0</td> <!-- JS hisoblab yozadi -->
                <td>{{ row.aloqa_clicks }}</td>
                <td class="ctr">0%</td> <!-- JS hisoblab yozadi -->
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        // Jadvalni yurib chiqamiz va "Bosmaganlar" + "CTR (%)" ni hisoblaymiz
        document.querySelectorAll("#monitoringTable tbody tr").forEach(row => {
            let read = parseInt(row.querySelector(".read_dm").innerText) || 0;
            let buy = parseInt(row.querySelector(".buy_clicks").innerText) || 0;
            let reach = parseInt(row.querySelector(".reach").innerText) || 0;

            // ‚ùå Bosmaganlar = Read DM - Buy
            let diff = read - buy;
            if (diff < 0) diff = 0;
            row.querySelector(".not_clicked").innerText = diff;

            // CTR (%) = Buy / Reach * 100
            let ctr = 0;
            if (reach > 0) {
                ctr = ((buy / reach) * 100).toFixed(2);
            }
            row.querySelector(".ctr").innerText = ctr + "%";
        });
    </script>
</body>
</html>
